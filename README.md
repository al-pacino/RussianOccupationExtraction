## RussianOccupationExtraction

Программа выполняет распознавание названий организации (и профессий) персон из текстов на русском языке.


## Общее описание

Для успешной работы программы требуется анализатор [mystem](https://tech.yandex.ru/mystem/), который должен располагаться в каталоге с исполняемым файлом программы.

Также для обрабатываемого текстового файла необходим список размеченных в нём именнованных сущностей, в формате определённом соревнованием [factRuEval-2016](https://github.com/dialogue-evaluation/factRuEval-2016) (файлы .objects и .spans). Это означает, что вместе с текстовым файлом в кодировке UTF-8 (расширение обязательно .txt) в этом же каталоге должны располагаться файлы .objects и .spans (описание формата файлов приведено ниже), имя которых полностью совпадает с именем текстового файла.

#### Файл .spans

Формально, каждая строка файла .spans должна иметь следующий вид:
```txt
id foo offset length ...
```
Где:
- id - уникальный (в рамках файла) идентификатор отрезка текстового файла
- foo - произвольный текстовый идентификатор, который реально не используется
- offset - смещение (в символах) отрезка текстового файла
- length - длина (в символах) отрезка текстового файла
- ... - любая (в том числе пустая) последовательность символов, до конца строки

#### Файл .objects

Формально, каждая строка файла .objects должна иметь следующий вид:
```txt
foo type span_ids ...
```
Где:
- id - foo произвольный числовой идентификатор, который реально не используется
- type - название именованной сущности, допустимые значения (с учётом регистра): Person, Location, Org, LocOrg
- span_ids - последовательность числовых идентификаторов отрезков текстового файла (из .spans), составляющих именованную сущность
- ... - любая (в том числе пустая) последовательность символов, до конца строки

Примеры файлов .spans и .objects можно найти в [репозитории соревнования factRuEval-2016](https://github.com/dialogue-evaluation/factRuEval-2016).


#### Файл словарей

Распознавание осуществляется на основе заданных пользователем шаблонов и словарей.

Словарь представляет собой обычный текстовый файл в кодировке Windows-1251, в каждой строке которого записана последовательность слов (допускаются последовательности из одного слова) на которую можно ссылаться в шаблоне. Также стоит отметить, что все слова в словаре должны быть записаны в начальной форме в нижнем регистре. Для примера рассмотрим словарь SampleDictionary.txt содержаший всего три словосочетания (слова): Консультант, Менеджер, Менеджер по работе с клиентами.

Файл SampleDictionary.txt:
```txt
консультант
менеджер
менеджер по работа с клиент
```

Пример файла словаря можно найти в данном репозитории: [data/ListOccupations.txt](https://github.com/al-pacino/RussianOccupationExtraction/blob/master/data/ListOccupations.txt).

#### Файл шаблонов

Файл шаблонов представляет собой обычный текстовый файл в кодировке Windows-1251, в каждой строке которого записан шаблон распознавания. В шаблоне допустимо ссылаться на словарные словосочетания (слова) с помощью конструкции @1, @2 и т.д., где номер после символа @ идёт номер словаря. Словари нумеруются с 1 в порядке, в котором они расположены в аргументах командной строки програмы. Также в шаблоне используются конструкции $P, $O и $L, обозначающие именованную сущность соотвественно персону, организацию и место. Для упрощения записи можно использовать опциональный элемент и альтернативу, обозначаемые одинаково с помощью квадратных скобок:
```txt
слово [опциональное_слово] [первое_слово|второе_слово|третье_слово] [первое_опциональное_слово|второе_опциональное_слово|]
```

Пример файла шаблонов можно найти в данном репозитории: [data/Templates.txt](https://github.com/al-pacino/RussianOccupationExtraction/blob/master/data/Templates.txt).


## Описание результата работы программы

Результатом работы программы является текстовый файл в кодировке UTF-8 с расширением .task3, имя которого совпадает с именем исходного файла. Этот файл содержит описание распознанных в тексте фактов в формате пригодном для автоматической оценки точности, полноты и F-меры [компаратором]([https://github.com/dialogue-evaluation/factRuEval-2016/blob/master/scripts/t3_eval.py), предоставленном в [репозитории соревнования factRuEval-2016](https://github.com/dialogue-evaluation/factRuEval-2016).

Данный файл содержит последовательное описание фактов в формате:
```txt
Occupation
who:имя персоны
where:название организации
job:профессия (данное поле может быть опущено)
```

Поля фактов содержат ненормализованный текст (такой как в исходном текстовом файле).

В качестве примера рассмотрим файл book_100.task3:
```txt
Occupation
who:Юрия Лужкова
where:Москвы
job:мэра

Occupation
who:Бориса Громова
where:подмосковного

Occupation
who:Михаил Вельмакин
where:московского отделения движения «Солидарность
job:сопредседатель

Occupation
who:Лев Пономарев
where:движения «Левый фронт
job:координатор
```


## Сборка программы в ОС семейства Windows

Достаточно собрать решение для Visual Studio 2015 (RussianOccupationExtraction.sln).

## Сборка программы в ОС семейства Unix/Linux/Mac OS

```sh
$ ./build.sh
```


## Запуск

```sh
$ ./occup text templates [dictionary]...
```

- text - имя текстового файла (без расширения, кодировка UTF-8)
- templates - имя файла шаблонов (кодировка Windows-1251)
- [dictionary]... (опционально) - последовательность имён файлов словарей (кодировка Windows-1251)


## Пример

Рассмотрим работу программы на примере текстового файла Sample_001.txt.

Файл Sample_001.txt:
```txt
Антон Тодуа - студент МГУ им. Ломоносова.
```
Файл Sample_001.spans:
```txt
1 name 0  5       # Антон
2 surname 6 5     # Тодуа
3 org_name 22 3   # МГУ
4 org_descr 26 14 # им. Ломоносова
```
Файл Sample_001.objects:
```txt
1 Person 1 2 # Антон Тодуа
2 Org 3 4    # МГУ им. Ломоносова
```
Файл OccupationsList.txt (список профессий):
```txt
студент
бакалавр
магистр
```
Файл Templates.txt (шаблоны извлечения):
```txt
$P - @1 $O
```
Запуск программы:
```sh
$ ./occup Sample_001 Templates.txt OccupationsList.txt
```
В результате работы программы в каталоге с файлами Sample_001.txt, Sample_001.spans и Sample_001.objects появится файл Sample_001.task3:
```txt
Occupation
who:Антон Тодуа
where:МГУ им. Ломоносова
job:студент
```


## Результат тестирования
### 
| Коллекция  | Точность   | Полнота    | F-мера     | Распознано фактов (всего) |
|:---------- | ----------:| ----------:| ----------:| -------------------------:|
| [devset](https://github.com/dialogue-evaluation/factRuEval-2016/tree/master/devset) | 0.8994 | 0.4480 | 0.5981 | 93 (180) |
| [testset](https://github.com/dialogue-evaluation/factRuEval-2016/tree/master/testset) | 0.8486 | 0.3972 | 0.5411 | 158 (330) |
